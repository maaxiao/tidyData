# Explanations to script "run_analysis.R"

### Summary of steps:
1. Read raw data.
2. Extract only the measurements on the mean and standard deviation.
3. Merge the training and the test sets to create one data set.
4. Appropriately label the data set with descriptive variable names.
5. Create a second data set with the average of each variable for each activity and each subject.
6. Use descriptive activity names to name the activities in the data set.
7. Save output data.

### Step 1: Read raw data.
* I renamed the download folder to 'UCI_HAR_Dataset' and placed the folder into my working directory.
* Each row in table "X_test" is generated by a specific volunteer (subject) performing a certain activity.  
* Each row in table "subject_test" tells who is the corresponding subject.
* Each row in table "Y_test" tells what is the corresponding activity.
* Each subject repeats an activity a few tens of times. 
* Each row in table "features" describes the variable name of each column in table "X_test".
* Table "Y_test" records the activity IDs, and table "activities" tells how to convert activity IDs to names.
* Same thing for the "_train" data.
```{r}
activities <- read.table('./UCI_HAR_Dataset/activity_labels.txt')
features <- read.table('./UCI_HAR_Dataset/features.txt')
subject_test <- read.table('./UCI_HAR_Dataset/test/subject_test.txt')
X_test <- read.table('./UCI_HAR_Dataset/test/X_test.txt')
Y_test <- read.table('./UCI_HAR_Dataset/test/Y_test.txt')
subject_train <- read.table('./UCI_HAR_Dataset/train/subject_train.txt')
X_train <- read.table('./UCI_HAR_Dataset/train/X_train.txt')
Y_train <- read.table('./UCI_HAR_Dataset/train/Y_train.txt')
```

### Step 2: Extract only the measurements on the mean and standard deviation.
* We select mean and std by checking the contents of table "features".
* Those and only those containing characters "mean" or "std" will be selected.
```{r}
selected <- grep('mean|std', features$V2)
features <- features[selected, ]
X_test <- X_test[, selected]
X_train <- X_train[, selected]
```

### Step 3: Merge the training and the test sets to create one data set.
* We combine '_test" and "_train" vertically.
* We combine activity ID, subject ID, and measured variables horizontally.
```{r}
selectedData <- cbind(rbind(Y_test, Y_train), rbind(subject_test, subject_train), rbind(X_test, X_train))
```

### Step 4: Appropriately label the data set with descriptive variable names.
* The first column is the activity ID. 
* The second column is subject ID.
* The remaining columns are the measured variables.
```{r}
colnames(selectedData)[1] <- 'activity'
colnames(selectedData)[2] <- 'subject'
colnames(selectedData)[3:ncol(selectedData)] <- features$V2
```

### Step 5: Create a second data set with the average of each variable for each activity and each subject.
* We sort the first data set by activity and subject, just for better vision.
* We group the first data set by two columns: activity and subject, and then calculate the column means.
* The column means don't change the values of subject and activity, since they are the same in a same group.
* In the final outcome, the first two columns refer to all distinct combinations of activity and subject. 
* And the remaining columns are the averaged measurements for each combination.
```{r}
selectedData <- selectedData[order(selectedData$activity, selectedData$subject), ]
groups <- split(selectedData,list(selectedData$subject, selectedData$activity))
averageData <- sapply(groups, colMeans)
averageData <- data.frame(t(averageData))
```

### Step 6: Use descriptive activity names to name the activities in the data set.
* Before saving the data sets, we convert the activity IDs to activity names.
* The conversion rule is recorded in table "activities".
```{r}
selectedData$activity <- activities$V2[selectedData$activity]
averageData$activity <- activities$V2[averageData$activity]
```

### Step 7: Save output data.
* We save the two data sets in a way complying with the project guidelines.
* They are saved to my working directory.
```{r}
write.table(selectedData, './tidyData.txt', row.name=FALSE)
write.table(averageData, './tidyAverageData.txt', row.name=FALSE)
```